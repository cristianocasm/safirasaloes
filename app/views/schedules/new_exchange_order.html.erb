<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Solicitação Enviada com Sucesso</h4>
      </div>
      <div class="modal-body">
        Sua Solicitação de Troca foi enviada com sucesso. Compareça ao estabelecimento no horário marcado e receba o serviço gratuitamente.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
      </div>
    </div>
  </div>
</div>

<h1>Enviar Solicitação de Troca</h1>

<% @professionals.each do |pr| %>

  <div class="col-xs-12 col-md-12 stablishment">
    <div class="col-xs-12 col-md-12">
      <h3><strong><%= "#{pr.nome.titleize} (Suas Safiras: #{current_customer.rewards.find_by_professional_id(pr.id).try(:total_safiras) || 0})" %></strong></h3>
    </div>
    <% pr.services.each do |srv| %>
      <div class="col-xs-12 col-md-12 service<%='-scheduled' if scheduled?(srv) %>">
        <div class="col-xs-12 col-md-8">
          <h5>Serviço: <%= srv.nome %></h5>
          <h5>Preço: <%= number_to_currency(srv.preco) %></h5>
          <h5>Recompensa: <%= pluralize(srv.recompensa_divulgacao, 'safira') %></h5>
          <% if srv.id.in?(@schedules.map(&:service).map(&:id)) %>
            <h5>Data: <%= @schedules.find_by_service_id(srv.id).datahora_inicio.strftime('%d/%m/%Y') %></h5>
            <h5>Hora: <%= @schedules.find_by_service_id(srv.id).datahora_inicio.strftime('%H:%M') %></h5>
          <% end %>
        </div>
        <% if srv.id.in?(@schedules.map(&:service).map(&:id)) && (current_customer.rewards.find_by_professional_id(pr.id).try(:total_safiras).try(:send, :>, @schedules.find_by_service_id(srv.id).recompensa_divulgacao)) && @schedules.find_by_service_id(srv.id).exchange_order_status.id == ExchangeOrderStatus.find_by_nome('inexistente').id %>
          <div class="col-xs-12 col-md-4 button-middle">
            <%= link_to 'Enviar Solicitação', create_exchange_order_path(exchange_order: { schedule_id: @schedules.find_by_service_id(srv.id).id }), :data => { :confirm => "Enviar Solicitação?" }, :method=>:post, remote: true, class: "btn btn-warning"  %>
          </div>
        <% else %>
        <div class="col-xs-12 col-md-4 button-middle dica" data-toggle="popover" data-trigger="hover" data-placement="left" data-html="true" title="Que pena..." data-content="Você ainda não pode enviar uma solicitação de troca para este serviço.<br/>
        Para trocar suas Safiras por este serviço
          <ol>
            <li> Junte mais <b><%= ((srv.preco / 0.5) - (current_customer.rewards.find_by_professional_id(pr.id).try(:total_safiras)||0)).ceil %></b> Safiras; </li>
            <li> Marque um horário com o profissional; </li>
            <li> Acesse esta página novamente, clique neste botão (ele estará ativo) para criar sua solicitação de troca e receba o serviço gratuitamente. </li>
          </ol>">
            <%= link_to 'Enviar Solicitação', {}, disabled: true, class: "btn btn-warning"  %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
  
<% end %>


<%= link_to 'Voltar', customer_root_path %>